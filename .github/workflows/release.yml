name: Release Rust

on:
  push:
    tags:
      - 'v*'

permissions:  # 添加权限设置
    contents: write  # 允许读写仓库内容   

jobs:
  create-release:  
    runs-on: ubuntu-latest  
    steps:  
      - uses: actions/checkout@v4  
      - uses: taiki-e/create-gh-release-action@v1  
        with:  
          # (required) GitHub token for creating GitHub Releases.  
          token: ${{ secrets.GITHUB_TOKEN }}  
  upload-assets:  
    needs: create-release  
    strategy:  
      matrix:  
        include:  
          - target: x86_64-unknown-linux-gnu
            os: ubuntu-latest  
          - target: x86_64-apple-darwin
            os: macos-latest
          - target: x86_64-pc-windows-gnu
            os: windows-latest
    runs-on: ${{ matrix.os }}  
    steps:  
      - uses: actions/checkout@v4  
      - uses: taiki-e/upload-rust-binary-action@v1  
        with:  
          # (required) Comma-separated list of binary names (non-extension portion of filename) to build and upload.  
          # Note that glob pattern is not supported yet.          bin: nping  
          bin: gdem
          # (optional) Target triple, default is host triple.  
          target: ${{ matrix.target }}  
          # (required) GitHub token for uploading assets to GitHub Releases.  
          token: ${{ secrets.GITHUB_TOKEN }}